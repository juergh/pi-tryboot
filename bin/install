#!/bin/bash -eu
#
# Install tryboot files
#

dest_dir=${1:-}

etc_dir="${dest_dir}"/etc
bin_dir="${dest_dir}"/usr/bin
lib_dir="${dest_dir}"/usr/lib/rpi-tryboot

# Install scripts
mkdir -p "${bin_dir}"
cp bin/tryboot-* "${bin_dir}"/

# Install helper library and hook scripts
mkdir -p "${lib_dir}"
cp bin/functions "${lib_dir}"/

# Install config files
mkdir -p "${etc_dir}"/default/tryboot.d "${etc_dir}"/tryboot.d
cp etc/tryboot "${etc_dir}"/default/
cp etc/tryboot.d/* "${etc_dir}"/tryboot.d/

# Install kernel postinst and postrm hooks
for d in postinst.d postrm.d ; do
	mkdir -p "${etc_dir}"/kernel/"${d}"
	cp etc/kernel/"${d}"/* "${etc_dir}"/kernel/"${d}"/
done
