#!/bin/bash -eu
#
# Install tryboot files
#

dest_dir=${1:-}

etc_dir="${dest_dir}"/etc
etc_tb_dir="${dest_dir}"/etc/tryboot.d
bin_dir="${dest_dir}"/usr/bin
lib_tb_dir="${dest_dir}"/usr/lib/rpi-tryboot

# Install firmware files
mkdir -p "${lib_tb_dir}"/tryboot
cp buildd/initrd.img "${lib_tb_dir}"/tryboot/
cp -r firmware/boot/firmware/* "${lib_tb_dir}"/tryboot/
find "${lib_tb_dir}"/tryboot -type f -exec chmod 644 {} +

# Install scripts
mkdir -p "${bin_dir}"
cp bin/tryboot-* "${bin_dir}"

# Install config snippets
mkdir -p "${etc_tb_dir}"
cp tryboot/* "${etc_tb_dir}"

# Install config files
mkdir -p "${etc_dir}"/default/tryboot.d
cp etc/tryboot "${etc_dir}"/default/
