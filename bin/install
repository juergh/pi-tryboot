#!/bin/bash -eu
#
# Install tryboot files
#

dest_dir=${1:-}

etc_dir="${dest_dir}"/etc
bin_dir="${dest_dir}"/usr/bin
lib_tb_dir="${dest_dir}"/usr/lib/rpi-tryboot

# Install firmware files
mkdir -p "${lib_tb_dir}"/tryboot
cp buildd/initrd.img "${lib_tb_dir}"/tryboot/
cp -r firmware/boot/firmware/* "${lib_tb_dir}"/tryboot/
find "${lib_tb_dir}"/tryboot -type f -exec chmod 644 {} +

# Install scripts and helper library
mkdir -p "${bin_dir}"
cp bin/tryboot-* "${bin_dir}"
cp bin/lib.sh "${lib_tb_dir}"

# Install config files
mkdir -p "${etc_dir}"/default/tryboot.d "${etc_dir}"/tryboot.d
cp etc/tryboot "${etc_dir}"/default/
cp etc/tryboot.d/* "${etc_dir}"/tryboot.d/
